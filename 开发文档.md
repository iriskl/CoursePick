# 教师信息的新增

## 在数据库创建教师信息表

```sql
CREATE TABLE `teacher` (
  `id` int(10) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `username` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '用户名',
  `password` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '密码',
  `name` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '姓名',
  `sex` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '性别',
  `title` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '职称',
  `speciality_id` int(10) DEFAULT NULL COMMENT '专业ID',
  `role` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '角色',
  `avatar` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '头像',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='教师信息';
```

## 在`entity`实体类创建`Teacher`类

```java
public class Teacher extends Account {

    private Integer id;
    private String username;
    private String password;
    private String name;
    private String sex;
    private String title;
    private Integer specialityId;
    private String role;
    private String avatar;

}
```

## 后端`TeacherController`层添加接口

```java
@PostMapping("/add")
public Result add(@RequestBody Teacher teacher) {
    teacherService.add(teacher);
    return Result.success();
}
```

请求参数和响应体参考api文档

## 后端`TeacherService`层添加接口处理逻辑

```java
public void add(Teacher teacher) {
    // 做一些逻辑处理
    Teacher dbTeacher = teacherMapper.selectByUsername(teacher.getUsername());
    if (ObjectUtil.isNotEmpty(dbTeacher)) {
        throw new CustomException("用户名已存在");
    }
    if (ObjectUtil.isEmpty(teacher.getPassword())) {
        teacher.setPassword("123456");
    }
    teacher.setRole("TEACHER");
    teacherMapper.insert(teacher);
}
```

## 后端`TeacherMapper`层以及对应xml文件添加数据库交互逻辑

```java
void insert(Teacher teacher);

@Select("select * from teacher where username = #{username}")
Teacher selectByUsername(String username);
```

```xml
<insert id="insert" parameterType="com.example.entity.Teacher" useGeneratedKeys="true">
    insert into teacher (username, password, name, avatar, role, sex, title, speciality_id)
    values (#{username}, #{password}, #{name}, #{avatar}, #{role}, #{sex}, #{title}, #{specialityId})
</insert>
```

## 前端`Teacher.vue`添加对应页面和js脚本

```html
<div style="margin-bottom: 10px">
  <el-button type="primary" @click="handleAdd">新增</el-button>
</div>
```

```html
<el-dialog title="教师信息" width="40%" v-model="data.formVisible" :close-on-click-modal="false" destroy-on-close>
  <el-form :model="data.form" label-width="100px" style="padding-right: 50px">
    <el-form-item label="账号" prop="username">
      <el-input v-model="data.form.username" autocomplete="off" placeholder="请输入账号"/>
    </el-form-item>
    <el-form-item label="姓名" prop="name">
      <el-input v-model="data.form.name" autocomplete="off" placeholder="请输入姓名"/>
    </el-form-item>
    <el-form-item label="性别" prop="sex">
      <el-select v-model="data.form.sex" placeholder="请选择性别" style="width: 100%">
        <el-option label="男" value="男"></el-option>
        <el-option label="女" value="女"></el-option>
      </el-select>
    </el-form-item>
    <el-form-item label="职称" prop="title">
      <el-select v-model="data.form.title" placeholder="请选择职称" style="width: 100%">
        <el-option label="讲师" value="讲师"></el-option>
        <el-option label="副教授" value="副教授"></el-option>
        <el-option label="教授" value="教授"></el-option>
      </el-select>
    </el-form-item>
  </el-form>
  <template #footer>
  <span class="dialog-footer">
    <el-button @click="data.formVisible = false">取 消</el-button>
    <el-button type="primary" @click="save">保 存</el-button>
  </span>
  </template>
</el-dialog>
```

```javascript
const handleAdd = () => {
  data.form = {}
  data.formVisible = true
}
```

```javascript
const save = () => {
  request.post('/teacher/add', data.form).then(res => {
    if (res.code === '200') {
      ElMessage.success('操作成功')
      data.formVisible = false
    } else {
      ElMessage.error(res.msg)
    }
  })
}
```



# 教师信息的分页查询以及条件查询



##  分页查询

### 前端创建div盒子放输入框、查询按钮、重置按钮

```html
<div class="card" style="margin-bottom: 5px">
  <el-input v-model="data.name" style="width: 300px; margin-right: 10px" placeholder="请输入教师姓名查询"></el-input>
  <el-button type="primary" @click="load">查询</el-button>
  <el-button type="info" @click="reset">重置</el-button>
</div>
```

###  前端创建表单显示教师信息

```html
<el-table :data="data.tableData" stripe>
  <el-table-column label="用户名" prop="username"></el-table-column>
  <el-table-column label="头像" prop="avatar"></el-table-column>
  <el-table-column label="名称" prop="name"></el-table-column>
  <el-table-column label="性别" prop="sex"></el-table-column>
  <el-table-column label="职称" prop="title"></el-table-column>
  <el-table-column label="角色" prop="role"></el-table-column>
  <el-table-column label="操作" align="center" width="160">
    <template #default="scope">
      <el-button type="primary" @click="handleEdit(scope.row)">编辑</el-button>
      <el-button type="danger" @click="handleDelete(scope.row.id)">删除</el-button>
    </template>
  </el-table-column>
</el-table>
```

### 前端创建分页按钮

```html
<div class="card">
  <el-pagination background layout="prev, pager, next" v-model:page-size="data.pageSize" v-model:current-page="data.pageNum" :total="data.total" @current-change="changePage"/>
</div>
```

### 前端`data`新增字段`tableData``pageNum``pageSize``total`

```javascript
const data = reactive({
  formVisible: false,
  form:{},
  tableData: [],
  pageNum: 1,
  pageSize: 5,
  total: 0
})
```

### 前端`load`函数加载表单信息

```javascript
const load = () => {
  request.get('/teacher/selectPage', {
    params: {
      pageNum: data.pageNum,
      pageSize: data.pageSize,
    }
  }).then(res => {
    if (res.code === '200') {
      data.tableData = res.data?.list
      data.total = res.data?.total
    } else {
      ElMessage.error(res.msg)
    }
  })
}
```

### 前端`changePage`事件与分页按钮绑定

```javascript
const changePage = (pageNum) => {
  data.pageNum = pageNum
  load()
}
```

### 后端`TeacherController`层添加接口

```java
@GetMapping("/selectPage")
public Result selectPage(@RequestParam(defaultValue = "1") Integer pageNum,
                         @RequestParam(defaultValue = "5") Integer pageSize) {
    PageInfo<Teacher> pageInfo = teacherService.selectPage(pageNum, pageSize);
    return Result.success(pageInfo);
}
```

### 后端`TeacherService`层添加接口处理逻辑

```java
public PageInfo<Teacher> selectPage(Integer pageNum, Integer pageSize) {
    PageHelper.startPage(pageNum, pageSize);
    List<Teacher> list = teacherMapper.selectAll();
    return PageInfo.of(list);
}
```

### 后端`TeacherMapper`层添加查询方法

```java
public PageInfo<Teacher> selectPage(Integer pageNum, Integer pageSize) {
    PageHelper.startPage(pageNum, pageSize);
    List<Teacher> list = teacherMapper.selectAll();
    return PageInfo.of(list);
}
```

## 条件查询（模糊查询）

### 前端`data`新增字段`name`

```javascript
const data = reactive({
  formVisible: false,
  form:{},
  tableData: [],
  pageNum: 1,
  pageSize: 5,
  total: 0,
  name: null
})
```

### 前端`load`函数新增`data.name`传入参数

```javascript
const load = () => {
  request.get('/teacher/selectPage', {
    params: {
      pageNum: data.pageNum,
      pageSize: data.pageSize,
      name: data.name
    }
  }).then(res => {
    if (res.code === '200') {
      data.tableData = res.data?.list
      data.total = res.data?.total
    } else {
      ElMessage.error(res.msg)
    }
  })
}
```

### 后端`TeacherController`层接口的传入参数新增`Teacher teacher`，使用`Teacher`中的各种字段查找，使得条件查询与分页查询共用一个接口

```java
@GetMapping("/selectPage")
public Result selectPage(Teacher teacher,
                         @RequestParam(defaultValue = "1") Integer pageNum,
                         @RequestParam(defaultValue = "5") Integer pageSize) {
    PageInfo<Teacher> pageInfo = teacherService.selectPage(teacher, pageNum, pageSize);
    return Result.success(pageInfo);
}
```

### 后端`TeacherService`层修改逻辑实现条件查询

```java
public PageInfo<Teacher> selectPage(Teacher teacher, Integer pageNum, Integer pageSize) {
    List<Teacher> list;
    PageHelper.startPage(pageNum, pageSize);
    if (ObjectUtil.isNotEmpty(teacher.getName())) {
        list = teacherMapper.selectByName(teacher.getName());
    } else {
        list = teacherMapper.selectAll();
    }
    return PageInfo.of(list);
}
```

### 后端`TeacherMapper`层添加根据姓名查询方法

```java
@Select("select * from teacher where name like concat('%', #{name}, '%')")
List<Teacher> selectByName(String name);
```

## 重置按钮

### 在前端定义`reset`事件，并于重置按钮绑定

```javascript
const reset = () => {
  data.name = null
  load()
}
```

## 保存按钮逻辑修改

由于新增教师信息后无法刷新教师信息显示，因此要给`save`事件加上一个`load()`

```javascript
const save = () => {
  request.post('/teacher/add', data.form).then(res => {
    if (res.code === '200') {
      ElMessage.success('操作成功')
      load()
      data.formVisible = false
    } else {
      ElMessage.error(res.msg)
    }
  })
}
```

# 教师信息的编辑（更新）

## 前端的编辑按钮与`handleEdit`事件绑定

```javascript
const handleEdit = (row) => {
  data.form = JSON.parse(JSON.stringify(row))
  data.formVisible = true
}
```

## 前端的保存按钮逻辑修改

- 将原有的`save`函数逻辑修改
- 新增`add`和`update`函数，分别代表新增和编辑（更新）

- 先判断`data.form.id`是否为空，为空则说明不存在，此时调用`add`函数；不为空说明用户已存在，此时调用`update`函数

```javascript
const add = () => {
  request.post('/teacher/add', data.form).then(res => {
    if (res.code === '200') {
      ElMessage.success('操作成功')
      load()
      data.formVisible = false
    } else {
      ElMessage.error(res.msg)
    }
  })
}

const update = () => {
  request.post('/teacher/update', data.form).then(res => {
    if (res.code === '200') {
      ElMessage.success('操作成功')
      load()
      data.formVisible = false
    } else {
      ElMessage.error(res.msg)
    }
  })
}

const save = () => {
  data.form.id ? update() : add()
}
```

## 后端添加`update`接口

```java
@PutMapping("/update")
public Result update(@RequestBody Teacher teacher) {
    teacherService.updateById(teacher);
    return Result.success();
}
```

## 后端的`TeacherService`和`TeacherMapper`分别添加对应`update`逻辑

略

## 给`TeacherMapper.xml`添加更新sql语句

```xml
 <update id="updateById" parameterType="com.example.entity.Teacher">
    update teacher
    set username = #{username}, password = #{password}, name = #{name}, avatar = #{avatar}, role = #{role}, sex = #{sex}, title = #{title}, speciality_id = #{specialityId}
    where id = #{id}
</update>
```

 ## 教师信息的删除

### 在前端定义`handleDelete`事件，并于删除按钮绑定

```javascript
const handleDelete = (id) => {
  ElMessageBox.confirm('删除后数据无法恢复，您确定删除吗?', '删除确认', { type: 'warning' }).then(res => {
    request.delete('/teacher/deleteById/' + id).then(res => {
      if (res.code === '200') {
        ElMessage.success('操作成功')
        load()
      } else {
        ElMessage.error(res.msg)
      }
    })
  }).catch(err => {})
}
```

### 而后在后端添加对应接口

```java
@DeleteMapping("/deleteById/{id}")
public Result deleteById(@PathVariable Integer id) {
    teacherService.deleteById(id);
    return Result.success();
}
```

### Mapper层添加对应删除sql注解

```java
@Delete("delete from teacher where id = #{id}")
void deleteById(Integer id);
```

## 教师头像的上传和渲染

### 后端不需要去动，后端原先脚手架已经在`FileController`写好了`upload`与`download`接口

- 具体实现思路直接去看接口源代码

### 前端先给教师信息表单加上头像渲染

```html
<el-table-column label="头像" prop="avatar">
  <template #default="scope">
    <el-image :src="scope.row.avatar" style="width: 40px; height: 40px; border-radius: 50%"></el-image>
  </template>
</el-table-column>
```

### 再在前端的信息编辑表单加上头像上传功能

```html
<el-form-item label="头像" prop="avatar">
  <el-upload :action="uploadUrl" list-type="picture" :on-success="handleImgSuccess">
    <el-button type="primary">上传图片</el-button>
  </el-upload>
</el-form-item>
```

这里使用到了`uploadUrl`这个文件上传接口与`handleImgSuccess`钩子函数

- `uploadUrl`:

  ```javascript
  //文件上传接口
  const uploadUrl = import.meta.env.VITE_BASE_URL + '/files/upload'
  ```

- `handleImgSuccess`:

  ```javascript
  const handleImgSuccess = (res) => {
    data.form.avatar = res.data
  }
  ```


### 学生信息的管理

### 先在数据库建表

```sql
CREATE TABLE `student` (
  `id` int(10) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `username` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '账号',
  `password` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '密码',
  `name` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '姓名',
  `role` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '角色',
  `sex` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '性别',
  `code` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '学号',
  `college_id` int(10) DEFAULT NULL COMMENT '学院ID',
  `score` int(10) DEFAULT NULL COMMENT '学分',
  `avatar` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '头像',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='学生信息';
```

### 在后端实体类`entity`创建`Student`

```java
public class Student extends Account {

    /** ID */
    private Integer id;
    /** 用户名 */
    private String username;
    /** 密码 */
    private String password;
    /** 角色 */
    private String role;
    /** 头像 */
    private String avatar;
    /** 姓名 */
    private String name;
    /** 性别 */
    private String sex;
    /** 学号 */
    private String code;
    /** 学院ID */
    private Integer collegeId;
    /** 学分 */
    private Integer score;

}
```

### 前端开一个`Student.vue`

- 在Manager.vue添加

```html
<el-menu-item index="/student"><el-icon><User /></el-icon><span>学生信息</span></el-menu-item>
```

- 在index.js添加对应学生信息页面路径

```javascript
{ path: 'student', component: () => import('@/views/manager/Student.vue')},
```

### 前端`Student.vue`的所有`/teacher`接口改为`/student`

### 后端`mapper`层与对应`xml`全部`teacher`改为`student`，`xml`中的字段与数据库对应

### 后端`Service`层改造

- 要记得这两行不一样

```java
student.setRole("STUDENT");
student.setScore(0);
```

### 后端`Controller`层改造

### 最后回到前端改变对应字段

